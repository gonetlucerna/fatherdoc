-- ============================= CREACION DEL ESQUEMA DE LA BASE DE DATOS ====================
-- ============================= TABLES (13) =======================
CREATE TABLE CONSULTORIO (
	ID		INTEGER	 NOT NULL ,
	EMAIL		INTEGER	 NOT NULL ,
	TELEFONOS		VARCHAR (255)	 ,
	DIRECCION		VARCHAR (255)	 NOT NULL ,
	CODIGO_POSTAL		INTEGER	 NOT NULL ,
	URL		VARCHAR (255)	 ,
	URL_GEOLOCALIZACION		VARCHAR (255)	 ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE USUARIO (
	ID		INTEGER	 NOT NULL ,
	EMAIL		VARCHAR (128)	 NOT NULL ,
	PASSWORD		VARCHAR (64)	 NOT NULL ,
	NOMBRES		VARCHAR (128)	 NOT NULL ,
	APELLIDOS		VARCHAR (128)	 NOT NULL ,
	FECHA_REGISTRO		TIMESTAMP	 NOT NULL ,
	FACEBOOK_ID		VARCHAR (128)	 ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE ROL (
	ID		INTEGER	 NOT NULL ,
	DESCRIPCION		VARCHAR (255)	 NOT NULL ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE ACCION_OPERATIVA (
	ID		INTEGER	 NOT NULL ,
	DESCRIPCION		VARCHAR (64)	 NOT NULL ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE CONSULTORIO_MEDICO (
	CONSULTORIO_ID		INTEGER	 NOT NULL ,
	MEDICO_CEDULA_PROFESIONAL		VARCHAR (16)	 NOT NULL ,
	PRIMARY KEY (CONSULTORIO_ID, MEDICO_CEDULA_PROFESIONAL)
);
-- ===============================================================================
CREATE TABLE HORARIO_ATENCION (
	ID		INTEGER	 NOT NULL ,
	DIA		INTEGER	 NOT NULL ,
	HORA_INICIO		INTEGER	 NOT NULL ,
	HORA_FIN		INTEGER	 NOT NULL ,
	CONSULTORIO_ID		INTEGER	 NOT NULL ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE ROL_USUARIO (
	ROL_ID		INTEGER	 NOT NULL ,
	USUARIO_ID		INTEGER	 NOT NULL ,
	PRIMARY KEY (ROL_ID, USUARIO_ID)
);
-- ===============================================================================
CREATE TABLE PACIENTE (
	CURP		VARCHAR (64)	 NOT NULL ,
	TIPO		INTEGER	 NOT NULL ,
	CLAVE_POLIZA		VARCHAR (64)	 ,
	VIGENCIA_POLIZA		DATE	 ,
	USUARIO_ID		INTEGER	 NOT NULL ,
	PRIMARY KEY (CURP)
);
-- ===============================================================================
CREATE TABLE ESPECIALIDAD_MEDICO (
	ESPECIALIDAD_ID		INTEGER	 NOT NULL ,
	MEDICO_CEDULA_PROFESIONAL		VARCHAR (16)	 NOT NULL ,
	CEDULA		VARCHAR (16)	 NOT NULL ,
	UNIVERSIDAD		VARCHAR (128)	 ,
	PAIS_CERTIFICACION		VARCHAR (3)	 ,
	ANIO_CERTIFICACION		DATE	 ,
	PRIMARY KEY (ESPECIALIDAD_ID, MEDICO_CEDULA_PROFESIONAL)
);
-- ===============================================================================
CREATE TABLE MEDICO (
	CEDULA_PROFESIONAL		VARCHAR (16)	 NOT NULL ,
	USUARIO_ID		INTEGER	 NOT NULL ,
	INTRODUCCION		VARCHAR (255)	 ,
	PRIMARY KEY (CEDULA_PROFESIONAL)
);
-- ===============================================================================
CREATE TABLE ESPECIALIDAD (
	ID		INTEGER	 NOT NULL ,
	NOMBRE		VARCHAR (128)	 NOT NULL ,
	PADRE_ESPECIALIDAD_ID		INTEGER	 ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE ROL_ACCION_OPERATIVA (
	ROLID		INTEGER	 NOT NULL ,
	ACCION_OPERATIVA_ID		INTEGER	 NOT NULL ,
	PRIMARY KEY (ROLID, ACCION_OPERATIVA_ID)
);
-- ===============================================================================
CREATE TABLE CITA_MEDICA (
	ID		INTEGER	 NOT NULL ,
	FECHA		TIMESTAMP	 NOT NULL ,
	MEDICO_CEDULA_PROFESIONAL		VARCHAR (16)	 NOT NULL ,
	PACIENTE_CURP		VARCHAR (64)	 NOT NULL ,
	TIEMPO_ESTIMADO		INTEGER	 NOT NULL ,
	MOTIVO		VARCHAR (255)	 ,
	FECHA_ATENCION		TIMESTAMP	 ,
	TIEMPO_ATENDIDO		INTEGER	 ,
	CALIFICACION		INTEGER	 ,
	CRITERIOS_SATISFACTORIOS		VARCHAR (255)	 ,
	COMENTARIOS_MEJORA		VARCHAR (255)	 ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
-- =================================== CONSTRAINTS ==============================
ALTER TABLE CONSULTORIO_MEDICO ADD FOREIGN KEY (CONSULTORIO_ID)	REFERENCES CONSULTORIO(ID);
ALTER TABLE CONSULTORIO_MEDICO ADD FOREIGN KEY (MEDICO_CEDULA_PROFESIONAL)	REFERENCES MEDICO(CEDULA_PROFESIONAL);
ALTER TABLE HORARIO_ATENCION ADD FOREIGN KEY (CONSULTORIO_ID)	REFERENCES CONSULTORIO(ID);
ALTER TABLE ROL_USUARIO ADD FOREIGN KEY (ROL_ID)	REFERENCES ROL(ID);
ALTER TABLE ROL_USUARIO ADD FOREIGN KEY (USUARIO_ID)	REFERENCES USUARIO(ID);
ALTER TABLE PACIENTE ADD FOREIGN KEY (USUARIO_ID)	REFERENCES USUARIO(ID);
ALTER TABLE ESPECIALIDAD_MEDICO ADD FOREIGN KEY (ESPECIALIDAD_ID)	REFERENCES ESPECIALIDAD(ID);
ALTER TABLE ESPECIALIDAD_MEDICO ADD FOREIGN KEY (MEDICO_CEDULA_PROFESIONAL)	REFERENCES MEDICO(CEDULA_PROFESIONAL);
ALTER TABLE MEDICO ADD FOREIGN KEY (USUARIO_ID)	REFERENCES USUARIO(ID);
ALTER TABLE ESPECIALIDAD ADD FOREIGN KEY (PADRE_ESPECIALIDAD_ID)	REFERENCES ESPECIALIDAD(ID);
ALTER TABLE ROL_ACCION_OPERATIVA ADD FOREIGN KEY (ROLID)	REFERENCES ROL(ID);
ALTER TABLE ROL_ACCION_OPERATIVA ADD FOREIGN KEY (ACCION_OPERATIVA_ID)	REFERENCES ACCION_OPERATIVA(ID);
ALTER TABLE CITA_MEDICA ADD FOREIGN KEY (MEDICO_CEDULA_PROFESIONAL)	REFERENCES MEDICO(CEDULA_PROFESIONAL);
ALTER TABLE CITA_MEDICA ADD FOREIGN KEY (PACIENTE_CURP)	REFERENCES PACIENTE(CURP);
